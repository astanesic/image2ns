<!DOCTYPE html>
<html lang="hr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Unos Inzulina</title>
</head>
<body style="font-family:sans-serif;padding:1rem">
  <h2>üì∑ Uƒçitaj sliku pumpe sa vrijednostima inzulina</h2>
  <input type="file" id="imageInput" accept="image/*" capture="environment" /><br/><br/>
  <button onclick="sendImage()">Po≈°alji sliku</button>
  <div id="confirmSection" style="display:none;margin-top:1rem">
    <h4>üßê Detektirani podaci:</h4>
    <pre id="detected"></pre>
    <button onclick="confirmUpload()">‚úÖ Po≈°alji u Nightscout</button>
  </div>
  <pre id="output" style="margin-top:1rem;white-space:pre-wrap"></pre>

  <script>
    let file = null;

    async function sendImage() {
      const fileInput = document.getElementById('imageInput');
      const output = document.getElementById('output');
      const detected = document.getElementById('detected');
      const confirmSection = document.getElementById('confirmSection');
      file = fileInput.files[0];
      if (!file) {
        output.innerText = '‚ö†Ô∏è Molimo odaberite sliku.';
        return;
      }

      const formData = new FormData();
      formData.append('image', file);

      output.innerText = '‚è≥ ≈†aljem sliku...';
      confirmSection.style.display = 'none';

      try {
        const res = await fetch('https://image2ns.onrender.com/upload', {
          method: 'POST',
          body: formData
        });

        const result = await res.json();
        if (res.ok && result.data) {
          detected.innerText = result.data.join("\n");
          confirmSection.style.display = 'block';
          output.innerText = '‚úÖ Pregledaj podatke ispod i potvrdi slanje';
        } else {
          output.innerText = result.message || result.error || '‚ö†Ô∏è Gre≈°ka pri obradi slike';
        }
      } catch (e) {
        output.innerText = '‚ùå Neuspjelo: ' + e;
      }
    }

 async function confirmUpload() {
  const output = document.getElementById('output');
  if (!file) return;

  const formData = new FormData();
  formData.append('image', file);
  formData.append('confirm', 'yes');

  output.innerText = 'üì§ ≈†aljem podatke u Nightscout...';

  try {
    const res = await fetch('https://image2ns.onrender.com/upload', {
      method: 'POST',
      body: formData
    });

    const result = await res.json();
    if (res.ok) {
      output.innerText =
        (result.message || '‚úÖ Podaci poslani.') +
        '\\n' +
        (result.log ? result.log.join('\\n') : '');
    } else {
      output.innerText = result.error || '‚ùå Gre≈°ka pri slanju.';
    }
  } catch (e) {
    output.innerText = '‚ùå Neuspjelo: ' + e.message;
  }
}


  </script>
</body>
</html>
